<script>
    // Simple dice game with localStorage
    function playDiceGame() {
        const user = localStorage.getItem('currentUser');
        if (!user) {
            alert('Please login first!');
            return;
        }
        
        const stake = parseInt(prompt('How much to bet?', '100'));
        if (isNaN(stake) || stake < 1) return;
        
        // Load user data
        const users = JSON.parse(localStorage.getItem('tws_users')) || {};
        const userData = users[user];
        
        if (userData.balance < stake) {
            alert('Not enough money!');
            return;
        }
        
        // Play game
        const yourRoll = Math.floor(Math.random() * 6) + 1;
        const opponentRoll = Math.floor(Math.random() * 6) + 1;
        
        let result = '';
        if (yourRoll > opponentRoll) {
            userData.balance += stake;
            result = `You won $${stake}! (${yourRoll} vs ${opponentRoll})`;
        } else if (opponentRoll > yourRoll) {
            userData.balance -= stake;
            result = `You lost $${stake}. (${yourRoll} vs ${opponentRoll})`;
        } else {
            result = `Tie! (${yourRoll} vs ${opponentRoll})`;
        }
        
        // Save
        users[user] = userData;
        localStorage.setItem('tws_users', JSON.stringify(users));
        
        // Add to history
        const history = JSON.parse(localStorage.getItem('game_history')) || [];
        history.push({
            date: new Date().toISOString(),
            player1: user,
            player2: 'Computer',
            game: 'dice',
            stake: stake,
            result: result,
            yourRoll: yourRoll,
            opponentRoll: opponentRoll
        });
        localStorage.setItem('game_history', JSON.stringify(history));
        
        alert(result + '\nNew balance: $' + userData.balance);
    }
</script>
